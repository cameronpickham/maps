// Generated by CoffeeScript 1.6.3
(function() {
  var map, mapOptions, plot, voronoiOverlay;

  mapOptions = {
    zoom: 12,
    center: new google.maps.LatLng(34.02234, -118.28512),
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    disableDefaultUI: true
  };

  map = new google.maps.Map(d3.select("#map-canvas").node(), mapOptions);

  voronoiOverlay = null;

  plot = function(place) {
    var info_window, latLng, marker;
    latLng = place.latLng;
    info_window = new google.maps.InfoWindow({
      content: "" + place.name + ": " + place.count
    });
    marker = new google.maps.Marker({
      map: map,
      position: new google.maps.LatLng(latLng[0], latLng[1])
    });
    google.maps.event.addListener(marker, 'mouseover', function() {
      return info_window.open(map, marker);
    });
    return google.maps.event.addListener(marker, 'mouseout', function() {
      return info_window.close();
    });
  };

  $.getJSON("./checkins.json", function(data) {
    google.maps.event.addDomListener(window, "load", (function() {
      var place, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        place = data[_i];
        _results.push(plot(place));
      }
      return _results;
    })());
    return voronoiOverlay = new App.Overlay(map, data);
  });

  $("#recent").click(function() {
    return $("#menu").collapse('toggle');
  });

  $(".recent").click(function(event) {
    var clickedId, ele, latLng, vals;
    clickedId = $(this).attr("id").substring(3);
    ele = $("body").find('#' + "input-" + clickedId);
    vals = ele.val().split(/[, ]+/);
    latLng = vals.map(function(v) {
      return parseFloat(v);
    });
    map.setCenter(new google.maps.LatLng(latLng[0], latLng[1]));
    return $("#menu").collapse('toggle');
  });

  $("#close").click(function() {
    return $("#menu").collapse('toggle');
  });

  $("#overlay-toggle").click(function(event) {
    return voronoiOverlay.toggleDOM();
  });

}).call(this);
